<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MindAR 3D 오브젝트 데모</title>
    <!--
      이 예제는 MindAR.js와 A‑Frame을 사용하여 이미지 타깃을 인식하면 3D 오브젝트(GLB)를 띄우는 방법을 보여줍니다.
      사용자가 포스터(타깃 이미지)를 카메라로 비추면 업로드한 3D 모델이 나타나고, 클릭하면 회전합니다.

      사전 준비:
      - targets.mind : 타깃 포스터 이미지를 MindAR 컴파일러로 변환한 파일. 같은 폴더에 두세요.
      - 3dcharacter.glb : 표시할 3D 모델 파일. 같은 폴더에 두세요.
    -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <!-- MindAR 이미지 추적 설정: targets.mind 파일을 사용합니다. -->
    <a-scene
      mindar-image="imageTargetSrc: targets.mind;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      embedded
      style="width: 100vw; height: 100vh;"
    >
      <!-- 3D 모델 에셋을 로드합니다. glTF/GLB 파일을 사용합니다. -->
      <a-assets>
        <a-asset-item id="characterModel" src="3dcharacter.glb"></a-asset-item>
      </a-assets>

      <!-- 카메라 설정: 커서를 사용하여 모델을 클릭 가능하게 만듭니다. -->
      <a-camera
        position="0 0 0"
        look-controls="enabled: false"
        cursor="rayOrigin: mouse"
        raycaster="objects: .clickable"
      ></a-camera>

      <!-- MindAR 타겟: targetIndex 0 을 사용합니다. -->
      <a-entity mindar-image-target="targetIndex: 0">
        <!-- 3D 모델을 배치합니다. 초기 scale 을 조절하여 크기를 맞춥니다. -->
        <a-gltf-model
          id="arModel"
          class="clickable"
          src="#characterModel"
          position="0 0 0.1"
          rotation="0 0 0"
          scale="0.4 0.4 0.4"
        ></a-gltf-model>
      </a-entity>
    </a-scene>

    <script>
      // 간단한 인터랙션: 모델을 클릭하면 회전 방향을 변경합니다.
      const modelEl = document.querySelector('#arModel');
      let rotate = false;
      modelEl.addEventListener('click', () => {
        rotate = !rotate;
      });
      // 애니메이션 루프: rotate 값이 true 일 때 모델을 회전시킵니다.
      function tick() {
        if (rotate) {
          const rotation = modelEl.getAttribute('rotation');
          rotation.y += 1; // 매 프레임마다 y축 회전
          modelEl.setAttribute('rotation', rotation);
        }
        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    </script>
  </body>
</html>